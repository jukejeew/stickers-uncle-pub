{{ define "main" }}
<h1 class="title">Sticker Portfolio</h1>

<div class="grid">
  {{ range $id, $s := site.Data.stickers }}
    {{ if ne $s.status "Hidden" }}
    <article class="card" data-status="{{ $s.status }}">

      {{/* --- Collect images from base_dir (under site/static/...) --- */}}
      {{ $base := $s.images.base_dir }}
      {{ $imgs := slice }}
      {{ $dir  := printf "static/%s" $base }}
      {{ if fileExists $dir }}
        {{ range (sort (readDir $dir) "Name") }}
          {{ $name  := .Name }}
          {{ $lower := $name | lower }}
          {{ if and (eq (path.Ext $lower) ".png") (ne $lower "cover.png") }}
            {{ $imgs = $imgs | append (printf "%s/%s" $base $name) }}
          {{ end }}
        {{ end }}
      {{ end }}

      {{/* --- Cover: use $s.cover if present; otherwise use first image --- */}}
      {{ $cover := or $s.cover $s.images.cover }}
      {{ if and (not $cover) (gt (len $imgs) 0) }}
        {{ $cover = index $imgs 0 }}
      {{ end }}

      <img class="cover" src="{{ $cover | relURL }}" alt="{{ $s.title_th }}"
            loading="eager" fetchpriority="high" decoding="async">

      <!-- thumbnails -->
      <img src="{{ . | relURL }}" alt="{{ $s.title_th }}"
            loading="lazy" decoding="async" style="width:64px;height:auto;">

      <h3>{{ $s.title_th }}</h3>
      {{ with $s.description_th }}<p>{{ . }}</p>{{ end }}

      <div class="meta">
        <span class="tag-list">{{ delimit $s.tags ", " }}</span>
        <span class="badge {{ lower $s.status }}">{{ $s.status }}</span>
      </div>

      {{/* (optional) thumbnails: show first 3 images */}}
      {{ if gt (len $imgs) 0 }}
        <div class="thumbs" style="margin:.5rem 0; display:flex; gap:6px;">
          {{ range first 3 $imgs }}
            <img src="{{ . | relURL }}" alt="{{ $s.title_th }}" style="width:64px;height:auto;border-radius:6px;border:1px solid #e5e7eb;">
          {{ end }}
        </div>
      {{ end }}

      <div class="actions">
        {{ if $s.line_store_url }}
          <a class="btn primary" href="{{ $s.line_store_url }}" target="_blank" rel="noopener">เปิดใน LINE Store</a>
        {{ else }}
          <button class="btn disabled" disabled aria-disabled="true" title="ยังไม่มีลิงก์—รออนุมัติ">รออนุมัติ</button>
        {{ end }}
      </div>

    {{ if eq hugo.Environment "development" }}
      <details class="howto">
        <summary>วิธีใส่ลิงก์หลังอนุมัติ</summary>
        <code>site/data/stickers/{{ $s.id }}.yml → line_store_url</code>
      </details>
    {{ end }}
    </article>
    {{ end }}
    {{ end }}
  {{ end }}
</div>
{{ end }}
